# SCW1/SCW2 PEPS CAN 通讯矩阵整理（开发适配版）

## 一、文档核心说明

本文档基于 KOSTAL Industrie Elektrik GmbH 的 SCW1/SCW2 PEPS（无钥匙进入和启动系统）CAN 诊断信息整理，聚焦 CAN 通讯关键参数（帧标识、传输模式、周期、信号含义、交互逻辑等），为通讯矩阵开发提供清晰的参数对照与逻辑说明，适用于硬件开发、软件调试及系统集成阶段参考。

## 二、唤醒帧通讯参数（PEPS Tx/Rx）

唤醒帧是 PEPS 与车身控制器（BCM/BSI）实现唤醒交互的核心帧，需优先明确收发双方的通讯规则，避免唤醒失效或误唤醒问题。

### （一）PEPS 发送唤醒帧（PEPS Tx）- 主动发起唤醒相关信号



| 适用型号 | 帧标识（ID） | 信号名称                      | 传输模式                   | 周期       | 核心交互逻辑（事件发送策略）                                                                                                                           | 关键备注                                   |
| ---- | ------- | ------------------------- | ---------------------- | -------- | ---------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------- |
| SCW1 | 0x05B   | PEPS\_BCCM\_05B.REV\_PEPS | 混合模式（Mixte，含周期 + 事件触发） | 200ms    | 满足以下任一条件，REV 信号重置为 0：1. 接收到 BCM 的唤醒请求（BCM\_WAKEUP=01）2. 接收到 BCM 发送的 0x442 帧（SC\_INFO\_BCCM\_442h）3. REV=1 状态持续 5 秒                       | REV 信号为唤醒请求核心标识，重置逻辑需严格匹配，避免持续发送无效唤醒信号 |
| SCW2 | 0x401   | REVEIL\_PEPS.REV\_PEPS    | 事件模式（仅当特定事件触发时发送）      | -（无固定周期） | 1. 当 PEPS 唤醒网络管理（NM）时，REV\_PEPS 信号先设为全 02. 持续等待两种结果：   - 接收到 BSI 的 0x036 帧（COMMANDES\_BSI\_36.PHASE\_VIE=1，正常状态）   - 等待超时（超时时间需参考诊断规范补充） | 需先发送全 0 信号 “占位”，确保 NM 唤醒后通讯同步，避免信号冲突   |

### （二）PEPS 接收唤醒帧（PEPS Rx）- 接收外部唤醒触发信号



| 适用型号 | 帧标识（ID） | 信号名称                          | 传输模式           | 周期    | 信号触发作用                                              | 接收处理要求                                                     |
| ---- | ------- | ----------------------------- | -------------- | ----- | --------------------------------------------------- | ---------------------------------------------------------- |
| SCW1 | 0x05A   | BCCM\_PEPS\_05A.BCM\_WAKEUP   | 事件模式           | -     | BCM 向 PEPS 发送唤醒请求，当信号值 = 1 时触发 PEPS 唤醒              | 需实时检测该信号，收到 “1” 后立即启动 PEPS 唤醒流程                            |
| SCW1 | 0x442   | SC\_INFO\_BCCM\_442h.KEY\_POS | 周期模式           | 100ms | 传输钥匙位置信息（任意值均需接收），兼具唤醒同步功能                          | 需按 100ms 周期稳定接收，确保钥匙位置数据实时更新，同时作为唤醒后同步信号                   |
| SCW2 | 0x036   | COMMANDES\_BSI\_36.PHASE\_VIE | 混合模式（含周期 + 事件） | 100ms | BSI 向 PEPS 反馈系统状态，当信号值 = 1 时表示 “正常状态”，用于 PEPS 唤醒后确认 | 需按 100ms 周期接收，优先检测 “PHASE\_VIE=1”，确认后停止 PEPS Tx 端的全 0 信号发送 |

## 三、核心诊断相关 CAN 信号（开发需关注的交互帧）

此类信号主要用于 PEPS 诊断、状态监控、功能配置，虽非实时控制帧，但需在通讯矩阵中预留诊断交互通道，确保诊断工具可正常读取 / 控制。

### （一）版本信息类（DID 对应 CAN 信号，用于读取 ECU 基础信息）



| DID（数据标识符） | 信号含义           | 适用型号      | 通讯交互说明                                | 开发注意事项                        |
| ---------- | -------------- | --------- | ------------------------------------- | ----------------------------- |
| F18C       | ECU 序列号        | SCW1/SCW2 | 诊断工具通过 CAN 发送 “读取 F18C” 请求，PEPS 反馈序列号 | 需确保信号长度、编码格式匹配诊断协议（如 UDS）     |
| F18B       | ECU 制造数据       | SCW1/SCW2 | 含生产批次、生产日期等信息，诊断请求后反馈                 | 数据格式需与整车厂制造系统兼容               |
| F186       | 激活诊断会话         | SCW1/SCW2 | 反馈当前 CAN 诊断会话状态（如默认会话、扩展会话）           | 需支持会话切换后的实时状态更新               |
| F180       | 引导软件识别         | SCW1/SCW2 | 反馈 PEPS 引导程序版本，用于软件升级校验               | 信号需唯一标识引导软件版本，避免升级错误          |
| F0FF       | STLA ECU 供应商代码 | SCW1/SCW2 | 标识 KOSTAL 供应商代码，固定值（需确认具体编码）          | 固定信号，无需动态变化，确保不传输错误代码         |
| F0FE       | PSA 识别区（ZI）    | SCW1/SCW2 | 标致雪铁龙集团专用识别信息                         | 按 PSA 规范编码，需与 BSI/BCM 的识别逻辑匹配 |
| F0FD       | PSA 供应商写入首个识别区 | SCW1/SCW2 | 供应商生产阶段写入的初始识别数据                      | 生产阶段一次性写入，后续不可修改，通讯中仅读        |
| F08F       | PSA EMC 标准化标签  | SCW1/SCW2 | 电磁兼容测试相关标识，反馈 EMC 合规状态                | 需确保信号与实际 EMC 测试结果一致           |

### （二）状态监控类（DID / 例行程序对应的 CAN 交互）



| 功能类型        | 标识（DID / 例行程序）            | 适用型号      | CAN 通讯逻辑                                                                | 开发关键要求                                      |
| ----------- | ------------------------- | --------- | ----------------------------------------------------------------------- | ------------------------------------------- |
| 天线诊断        | 例行程序 DF01                 | SCW1/SCW2 | 诊断工具发送 “启动 DF01” 请求（CAN 帧），PEPS 执行天线诊断后反馈结果（如天线故障码、正常状态）                | 需定义诊断请求帧格式（如 UDS 服务 ID + 子功能）、反馈帧的信号长度与故障编码 |
| 天线 - CID 通讯 | 例行程序 DF08                 | SCW1/SCW2 | 诊断工具触发 DF08 后，PEPS 向每个天线发送测试信号，同时通过 CAN 反馈与 CID（控制器）的通讯状态               | 需支持多天线逐一测试，反馈信号需区分不同天线（如天线 1 通讯正常、天线 2 故障）  |
| 调试帧控制       | 例行程序 DFFD                 | SCW1/SCW2 | 诊断工具发送 “启用 / 禁用调试帧” 请求（CAN 信号含控制指令），PEPS 执行后反馈操作结果                      | 调试帧需单独定义帧标识，仅在 DFFD 启用时发送，避免干扰正常通讯          |
| 运输模式控制      | 例行程序 DF12                 | SCW1（仅用）  | 诊断工具发送 “启用 / 禁用运输模式” 指令，PEPS 切换模式后通过 CAN 反馈当前模式状态                       | 运输模式下需关闭部分功能（如唤醒功能），通讯中需明确模式标识信号            |
| 内存操作        | 例行程序 FF00（擦除）/FF04（检查）    | SCW1/SCW2 | 1. 擦除内存：诊断请求后，PEPS 执行擦除并反馈 “成功 / 失败”2. 检查内存：PEPS 检测内存完整性后，反馈 “正常 / 错误码” | 擦除操作需加权限校验（避免误操作），反馈信号需包含错误原因（如内存损坏）        |
| RCD 控制      | IO 控制 D400（SCW1）          | SCW1（仅用）  | 诊断工具发送 RCD（如遥控接收模块）控制指令（启用 / 禁用 / 测试），PEPS 执行后反馈 RCD 状态                 | 需定义 RCD 控制信号的编码（如 1 = 启用、0 = 禁用），状态反馈需实时同步  |
| 门把手开关控制     | IO 控制 E410/DID E410（SCW2） | SCW2（仅用）  | 1. 控制：发送开关控制指令（如锁止 / 解锁）2. 状态读取：通过 DID E410 读取当前开关状态                    | 控制指令需与门锁执行器的 CAN 信号联动，状态反馈需延迟≤100ms         |
| 钥匙电池低指示     | DID D42C                  | SCW1/SCW2 | PEPS 检测到遥控钥匙电量低时，通过 CAN 发送 “电池低” 信号（如 1 = 低电量、0 = 正常）                   | 信号需持续发送（建议周期 1s），直至钥匙更换电池，避免漏报              |
| 钥匙运动传感器状态   | DID D471                  | SCW1/SCW2 | PEPS 接收钥匙运动传感器信号后，通过 CAN 反馈 “激活 / 未激活”（如钥匙移动时激活）                        | 状态信号需与钥匙唤醒逻辑联动，激活时触发 PEPS 唤醒检测              |
| 钥匙学习数量      | DID DB93                  | SCW1/SCW2 | PEPS 实时统计已学习钥匙数量，诊断工具读取时通过 CAN 反馈具体数值                                   | 数量需限制最大值（如 8 把），达到上限时反馈 “满额” 信号，禁止新增学习      |

### （三）钥匙学习类（CAN 交互逻辑）

钥匙学习是 PEPS 核心功能，需明确学习流程中的 CAN 信号交互顺序，确保学习成功且不冲突。



| 功能标识（例行程序 / DID） | 适用型号      | CAN 通讯流程                                                                                             | 开发适配点                                             |
| ---------------- | --------- | ---------------------------------------------------------------------------------------------------- | ------------------------------------------------- |
| 解锁学习权限（DF05）     | SCW1/SCW2 | 1. 诊断工具发送 “解锁 DF05” 请求（含权限码）2. PEPS 校验通过后，通过 CAN 反馈 “已解锁”                                            | 权限码需加密传输（避免非法学习），解锁状态持续时间需限制（如 5 分钟）              |
| ADC 代码学习（DF06）   | SCW1/SCW2 | 1. 诊断工具触发 DF06，发送 ADC 代码（如钥匙唯一编码）2. PEPS 接收代码并存储，反馈 “学习成功 / 失败”                                      | ADC 代码需按固定格式传输（如 16 位编码），失败反馈需含原因（如代码重复）          |
| 常规钥匙学习（DF07）     | SCW1/SCW2 | 1. 诊断工具启动 DF07，发送 “开始学习” 指令2. PEPS 进入学习模式，通过 CAN 发送 “等待钥匙触发” 信号3. 钥匙触发（如按解锁键）后，PEPS 存储钥匙信息，反馈 “学习完成” | 学习模式下需屏蔽其他唤醒信号，反馈信号需包含已学习数量（如当前已学 3 把）            |
| 扫描数据学习（DF38）     | SCW2（仅用）  | 1. 诊断工具发送 “扫描学习” 指令，PEPS 进入扫描模式2. PEPS 扫描周边钥匙信号，通过 CAN 反馈 “发现钥匙数量”3. 选择目标钥匙后，PEPS 学习并反馈结果            | 扫描范围需限制（如 10 米内），CAN 反馈需包含钥匙 ID（便于区分）             |
| VIN 代码学习（DF50）   | SCW1/SCW2 | 1. 诊断工具发送车辆 VIN 码（CAN 信号含完整 VIN）2. PEPS 存储 VIN 并校验格式，反馈 “学习成功 / 格式错误”                                | VIN 码需按 ISO 标准格式传输（17 位），存储后不可修改，通讯中需支持读取（通过 DID） |
| 学习状态反馈（E530）     | SCW1/SCW2 | 1. 学习过程中：反馈 “学习中 / 等待触发”2. 学习完成后：反馈 “成功 / 失败（含错误码）”                                                  | 状态信号需实时更新（周期≤500ms），错误码需对应具体问题（如通讯超时）             |

### （四）网络安全类（CAN 交互逻辑）

网络安全相关 CAN 信号需满足加密、权限校验要求，防止非法入侵或篡改。



| 功能标识（例行程序 / DID）   | 适用型号      | CAN 通讯逻辑                                                                    | 开发安全要求                                       |
| ------------------ | --------- | --------------------------------------------------------------------------- | -------------------------------------------- |
| 对称密钥发送（0603）       | SCW1（仅用）  | 1. PEPS 生成对称密钥（加密格式）2. 通过 CAN 向 BCM 发送加密密钥3. BCM 解密校验后，反馈 “接收成功”            | 密钥需用硬件加密模块生成，传输帧需加时间戳（防止重放攻击），密钥有效期≤24 小时    |
| 安全更新状态（DADE）       | SCW1/SCW2 | PEPS 执行安全更新（如软件升级）后，通过 CAN 反馈 “更新成功 / 失败 / 进度”（如 50%= 更新中）                  | 更新失败时需反馈错误原因（如文件损坏），进度信号周期建议 1s              |
| Seacom 学习状态（E431）  | SCW2（仅用）  | PEPS 学习 Seacom（安全通讯模块）信息后，反馈 “学习成功 / 未学习 / 失败”                              | 学习过程需与 Seacom 的 CAN 信号双向校验，未学习状态下禁止安全功能      |
| SA 实施状态读取（F025）    | SCW2（仅用）  | 诊断工具发送 “读取 F025” 请求，PEPS 反馈当前 SA（安全域）的实施状态（如启用 / 禁用）                        | 状态信号需与整车安全策略同步，禁用时需反馈禁用原因（如配置错误）             |
| 密钥元数据读取（F026/F027） | SCW2（仅用）  | 1. F026：读取工厂密钥元数据（如密钥生成时间、有效期）2. F027：读取售后密钥元数据3. F026 额外支持读取网络安全唯一标识号（UIN） | 元数据仅允许授权诊断工具读取（加权限校验），UIN 需唯一且不可修改           |
| SA 模式切换（070D）      | SCW2（仅用）  | 诊断工具发送 “切换传统 SA/eSA” 指令（含授权码），PEPS 切换后反馈当前模式                                | 切换需重启 PEPS 生效，反馈信号需包含模式标识（如 1=eSA、0 = 传统 SA） |
| ECU 永久锁定（070E）     | SCW2（仅用）  | 诊断工具发送 “锁定 ESA 模式” 指令，PEPS 执行后永久锁定（不可解锁），反馈 “锁定成功”                          | 需加多重确认（如连续两次发送指令），避免误操作，锁定后禁止模式切换            |
| 工厂密钥失效（070F）       | SCW2（仅用）  | 诊断工具发送 “失效工厂密钥” 指令，PEPS 使工厂密钥失效后，反馈 “失效成功”                                  | 失效后仅可使用售后密钥，反馈信号需明确 “工厂密钥状态（失效 / 有效）”        |
| Seacom 旁路控制（DF13）  | SCW2（仅用）  | 诊断工具发送 “启用 / 禁用 Seacom 旁路” 指令（仅维修时使用），PEPS 执行后反馈结果                          | 旁路模式仅允许在维修会话下启用，启用后需在 CAN 中标记 “维修模式”，避免安全风险  |

## 四、开发关键注意事项



1.  **帧标识唯一性**：所有 CAN 帧标识（如 0x05B、0x401）需与整车 CAN 网络中其他 ECU（如 BCM、BSI、仪表）的帧标识无冲突，建议在矩阵中备注 “专属帧 / 共享帧”。

2.  **传输周期与延迟**：周期帧需严格按文档标注执行（如 0x442 周期 100ms），事件帧的触发延迟需≤100ms（避免功能卡顿），建议在矩阵中补充 “最大延迟” 参数。

3.  **信号编码定义**：所有信号（如 REV\_PEPS、PHASE\_VIE）需明确 “位长、数据类型（无符号 / 有符号）、取值范围、单位（如需）”，例如 “REV\_PEPS：1 位，无符号，取值 0/1（0 = 重置、1 = 请求）”。

4.  **错误处理机制**：在矩阵中补充 “错误反馈信号”，如帧发送失败时的重试次数（建议 3 次）、错误码定义（如 0x01 = 帧丢失、0x02 = 信号无效），确保故障可追溯。

5.  **文档参考优先级**：涉及详细参数（如超时时间、加密算法、权限校验规则）需参考文档中链接的诊断规范（如 SCW1 对应 DOC03517191、SCW2 对应 DOC03517188），本文档未明确的需以规范为准。
